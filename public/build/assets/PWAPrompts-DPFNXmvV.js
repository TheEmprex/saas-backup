var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,a=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,i=(e,t,n)=>new Promise((r,a)=>{var i=e=>{try{o(n.next(e))}catch(t){a(t)}},l=e=>{try{o(n.throw(e))}catch(t){a(t)}},o=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,l);o((n=n.apply(e,t)).next())});import{r as l,o,w as s,a as d,b as u,d as c,e as f,f as g,g as p,u as m,h as v,T as b}from"./vue-vendor-CqjvUEUK.js";import{_ as y}from"./preload-helper-Cqtb6kru.js";function h(e={}){const{immediate:t=!0,onNeedRefresh:n,onOfflineReady:r,onRegistered:a,onRegisteredSW:o,onRegisterError:s}=e,d=l(!1),u=l(!1),c=function(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:a,onRegisteredSW:l,onRegisterError:o}=e;let s,d;return d=function(){return i(this,null,function*(){if("serviceWorker"in navigator){if(s=yield y(()=>i(null,null,function*(){const{Workbox:e}=yield import("./workbox-window.prod.es5-DMXp7Fa7.js");return{Workbox:e}}),[]).then(({Workbox:e})=>new e("/build/sw.js",{scope:"/build/",type:"classic"})).catch(e=>{null==o||o(e)}),!s)return;s.addEventListener("activated",e=>{(e.isUpdate||e.isExternal)&&window.location.reload()}),s.addEventListener("installed",e=>{e.isUpdate||null==r||r()}),s.register({immediate:t}).then(e=>{l?l("/build/sw.js",e):null==a||a(e)}).catch(e=>{null==o||o(e)})}})}(),(e=!0)=>i(null,null,function*(){yield d})}({immediate:t,onNeedRefresh(){d.value=!0,null==n||n()},onOfflineReady(){u.value=!0,null==r||r()},onRegistered:a,onRegisteredSW:o,onRegisterError:s});return{updateServiceWorker:c,offlineReady:u,needRefresh:d}}function x(){const e=l(null),s=l(!1),d=l(!1),u=l(!1),{needRefresh:c,updateServiceWorker:f,offlineReady:g}=h({onRegistered(e){},onRegisterError(e){}}),p=t=>{t.preventDefault(),e.value=t,s.value=!0},m=(e,i={})=>{if("granted"!==Notification.permission)return;const l=new Notification(e,((e,i)=>{for(var l in i||(i={}))n.call(i,l)&&a(e,l,i[l]);if(t)for(var l of t(i))r.call(i,l)&&a(e,l,i[l]);return e})({icon:"/pwa-192x192.png",badge:"/pwa-64x64.png",tag:"onlyverified-notification",renotify:!0},i));return setTimeout(()=>l.close(),5e3),l},v=l(!1),b=l({used:0,quota:0,percentage:0}),y=()=>i(null,null,function*(){if("storage"in navigator&&"estimate"in navigator.storage)try{const e=yield navigator.storage.estimate();b.value={used:e.usage||0,quota:e.quota||0,percentage:e.quota?Math.round(e.usage/e.quota*100):0}}catch(e){}});o(()=>{u.value=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),d.value=u.value,v.value="share"in navigator,window.addEventListener("beforeinstallprompt",p),window.addEventListener("appinstalled",()=>{d.value=!0,s.value=!1,e.value=null,m("OnlyVerified installed!",{body:"The app is now available from your home screen",icon:"/pwa-192x192.png"})}),y(),setInterval(y,3e4)});return{isInstallable:s,isInstalled:d,isStandalone:u,installPWA:()=>i(null,null,function*(){if(!e.value)return!1;try{e.value.prompt();const t=yield e.value.userChoice;return"accepted"===t.outcome&&(d.value=!0,s.value=!1),e.value=null,"accepted"===t.outcome}catch(t){return!1}}),needRefresh:c,offlineReady:g,updatePWA:()=>i(null,null,function*(){try{yield f(),window.location.reload()}catch(e){}}),requestNotificationPermission:()=>i(null,null,function*(){if(!("Notification"in window))return!1;if("granted"===Notification.permission)return!0;if("denied"!==Notification.permission){return"granted"===(yield Notification.requestPermission())}return!1}),showNotification:m,subscribeToPush:()=>i(null,null,function*(){try{if(!("serviceWorker"in navigator)||!("PushManager"in window))return{ok:!1,reason:"unsupported"};const e=(yield navigator.serviceWorker.getRegistration("/build/"))||(yield navigator.serviceWorker.ready);if(yield e.pushManager.getSubscription())return{ok:!0,existing:!0};const t=void 0;if(!t)return{ok:!1,reason:"missing_vapid"};const n=function(e){const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/-/g,"+").replace(/_/g,"/"),r=window.atob(n),a=new Uint8Array(r.length);for(let i=0;i<r.length;++i)a[i]=r.charCodeAt(i);return a}(t),r=yield e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n}),a={endpoint:r.endpoint,auth:btoa(String.fromCharCode.apply(null,new Uint8Array(r.getKey("auth")))),p256dh:btoa(String.fromCharCode.apply(null,new Uint8Array(r.getKey("p256dh")))),ua:navigator.userAgent};return yield fetch("/api/marketplace/v1/webpush/subscriptions",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify(a)}),{ok:!0}}catch(e){return{ok:!1,error:e}}}),unsubscribeFromPush:()=>i(null,null,function*(){try{const e=(yield navigator.serviceWorker.getRegistration("/build/"))||(yield navigator.serviceWorker.ready),t=yield e.pushManager.getSubscription();if(!t)return{ok:!0};const n=t.endpoint;return yield t.unsubscribe(),yield fetch("/api/marketplace/v1/webpush/subscriptions",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({endpoint:n})}),{ok:!0}}catch(e){return{ok:!1,error:e}}}),canShare:v,share:e=>i(null,null,function*(){if(!navigator.share){if(navigator.clipboard&&e.url)try{return yield navigator.clipboard.writeText(e.url),m("Link copied to clipboard!",{body:"You can now paste it anywhere",icon:"/pwa-64x64.png"}),!0}catch(t){return!1}return!1}try{return yield navigator.share(e),!0}catch(t){return t.name,!1}}),storageQuota:b,checkStorageQuota:y,cleanup:()=>{window.removeEventListener("beforeinstallprompt",p)}}}const w=(e,t)=>{const n=e.__vccOpts||e;for(const[r,a]of t)n[r]=a;return n},k={class:"pwa-prompts"},R={key:0,class:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-80 z-50"},O={key:0,class:"fixed top-4 left-4 right-4 md:left-auto md:right-4 md:w-80 z-50"},S={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 p-4"},P={class:"mt-4 flex space-x-2"},N={key:0,class:"fixed top-4 left-4 right-4 md:left-auto md:right-4 md:w-80 z-50"},W={class:"bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800 p-4"},_={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},E=w({__name:"PWAPrompts",setup(e){const t=x(),n=l(!1),r=l(!1),a=l(!1),y=()=>i(null,null,function*(){a.value=!0;try{(yield t.installPWA())&&(n.value=!0,setTimeout(()=>{t.showNotification("OnlyVerified Installed!",{body:"The app is now available from your home screen",icon:"/pwa-192x192.png"})},1e3))}catch(e){}finally{a.value=!1}}),h=()=>i(null,null,function*(){try{yield t.updatePWA()}catch(e){}}),w=()=>{n.value=!0,localStorage.setItem("pwa-install-dismissed",Date.now().toString())};return s(()=>t.offlineReady.value,e=>{e&&(r.value=!0,setTimeout(()=>{r.value=!1},5e3))}),s(()=>t.isStandalone.value,e=>i(null,null,function*(){e&&setTimeout(()=>i(null,null,function*(){yield t.requestNotificationPermission()}),2e3)})),o(()=>{(()=>{const e=localStorage.getItem("pwa-install-dismissed");if(e){const t=parseInt(e),r=864e5;Date.now()-t<r&&(n.value=!0)}})()}),d(()=>{t.cleanup()}),(e,i)=>(c(),u("div",k,[f(b,{name:"slide-up"},{default:g(()=>[m(t).isInstallable.value&&!n.value?(c(),u("div",R,[v("div",{class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4"},[i[2]||(i[2]=v("div",{class:"flex items-start space-x-3"},[v("div",{class:"flex-shrink-0"},[v("img",{src:"/images/onlyverified-logo.svg",alt:"OnlyVerified",class:"w-8 h-8"})]),v("div",{class:"flex-1 min-w-0"},[v("h3",{class:"text-sm font-medium text-gray-900 dark:text-white"}," Install OnlyVerified "),v("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"}," Get the full app experience with offline access and notifications ")])],-1)),v("div",{class:"mt-4 flex space-x-2"},[v("button",{onClick:y,class:"flex-1 bg-indigo-600 hover:bg-indigo-700 text-white text-sm px-3 py-2 rounded-md font-medium transition-colors"}," Install "),v("button",{onClick:w,class:"flex-1 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm px-3 py-2 rounded-md font-medium transition-colors"}," Not now ")])])])):p("",!0)]),_:1}),f(b,{name:"slide-up"},{default:g(()=>[m(t).needRefresh.value?(c(),u("div",O,[v("div",S,[i[3]||(i[3]=v("div",{class:"flex items-start space-x-3"},[v("div",{class:"flex-shrink-0"},[v("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[v("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])]),v("div",{class:"flex-1 min-w-0"},[v("h3",{class:"text-sm font-medium text-blue-800 dark:text-blue-200"}," Update Available "),v("p",{class:"text-sm text-blue-600 dark:text-blue-300 mt-1"}," A new version of OnlyVerified is ready to install ")])],-1)),v("div",P,[v("button",{onClick:h,class:"flex-1 bg-blue-600 hover:bg-blue-700 text-white text-sm px-3 py-2 rounded-md font-medium transition-colors"}," Update Now "),v("button",{onClick:i[0]||(i[0]=e=>m(t).needRefresh.value=!1),class:"flex-1 bg-blue-100 dark:bg-blue-800 hover:bg-blue-200 dark:hover:bg-blue-700 text-blue-700 dark:text-blue-200 text-sm px-3 py-2 rounded-md font-medium transition-colors"}," Later ")])])])):p("",!0)]),_:1}),f(b,{name:"slide-up"},{default:g(()=>[r.value?(c(),u("div",N,[v("div",W,[i[4]||(i[4]=v("div",{class:"flex items-start space-x-3"},[v("div",{class:"flex-shrink-0"},[v("svg",{class:"w-5 h-5 text-green-600 dark:text-green-400",fill:"currentColor",viewBox:"0 0 20 20"},[v("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])]),v("div",{class:"flex-1 min-w-0"},[v("h3",{class:"text-sm font-medium text-green-800 dark:text-green-200"}," Ready for Offline Use "),v("p",{class:"text-sm text-green-600 dark:text-green-300 mt-1"}," OnlyVerified is now available offline ")])],-1)),v("button",{onClick:i[1]||(i[1]=e=>r.value=!1),class:"mt-3 text-sm text-green-600 dark:text-green-400 hover:text-green-500 font-medium"}," Dismiss ")])])):p("",!0)]),_:1}),f(b,{name:"fade"},{default:g(()=>[a.value?(c(),u("div",_,[...i[5]||(i[5]=[v("div",{class:"bg-white dark:bg-gray-800 rounded-lg p-6 m-4 text-center"},[v("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),v("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"}," Installing OnlyVerified "),v("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," Please wait while the app is being installed... ")],-1)])])):p("",!0)]),_:1})]))}},[["__scopeId","data-v-47bdea68"]]);export{E as P,w as _};
