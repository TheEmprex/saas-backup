let t=null,c=null,o=null,s=!1,a=!1;const m={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]};function f(){console.log("WebRTC initialized")}window.startAudioCall=function(){console.log("Starting audio call..."),a=!1,r(),g(!1)};window.startVideoCall=function(){console.log("Starting video call..."),a=!0,r(),g(!0)};function r(){const e=document.getElementById("call-modal"),n=document.getElementById("video-container"),l=document.getElementById("audio-container");e&&(e.classList.remove("hidden"),a?(n.classList.remove("hidden"),l.classList.add("hidden")):(l.classList.remove("hidden"),n.classList.add("hidden")))}function u(){const e=document.getElementById("call-modal");e&&e.classList.add("hidden")}window.endCall=function(){console.log("Ending call..."),s=!1,t&&(t.getTracks().forEach(e=>e.stop()),t=null),o&&(o.close(),o=null),u()};async function g(e){try{const n={audio:!0,video:e};t=await navigator.mediaDevices.getUserMedia(n);const l=document.getElementById("local-video");l&&e&&(l.srcObject=t),o=new RTCPeerConnection(m),t.getTracks().forEach(i=>{o.addTrack(i,t)}),o.ontrack=i=>{c=i.streams[0];const d=document.getElementById("remote-video");d&&(d.srcObject=c)},o.onicecandidate=i=>{i.candidate&&C({type:"ice-candidate",candidate:i.candidate})},s=!0,console.log("Call initiated successfully")}catch(n){console.error("Error initiating call:",n),alert("Error accessing camera/microphone. Please check permissions."),u()}}function C(e){console.log("Sending signaling message:",e)}window.toggleAudio=function(){if(t){const e=t.getAudioTracks()[0];if(e){e.enabled=!e.enabled;const n=document.getElementById("mute-button");n&&(n.textContent=e.enabled?"Mute":"Unmute")}}};window.toggleVideo=function(){if(t&&a){const e=t.getVideoTracks()[0];if(e){e.enabled=!e.enabled;const n=document.getElementById("video-button");n&&(n.textContent=e.enabled?"Turn Off Video":"Turn On Video")}}};document.addEventListener("DOMContentLoaded",function(){f()});
